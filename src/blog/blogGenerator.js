const TYPE_ORDER = ["news", "stories", "guides"];

export const BLOG_TYPES = [
  { value: "all", label: { EN: "All", AR: "الكل" } },
  { value: "news", label: { EN: "News", AR: "الأخبار" } },
  { value: "stories", label: { EN: "Stories", AR: "قصص" } },
  { value: "guides", label: { EN: "Guides", AR: "أدلة" } },
];

const COVER_GRADIENTS = [
  ["#0f172a", "#38bdf8"],
  ["#0f172a", "#4f46e5"],
  ["#1f2937", "#22c55e"],
  ["#111827", "#f97316"],
  ["#0b1120", "#14b8a6"],
  ["#111827", "#a855f7"],
  ["#0f172a", "#f43f5e"],
  ["#111827", "#38bdf8"],
];

const NEWS_LIBRARY = [
  {
    title_ar: "إطلاق لوحة مؤشرات السوق الأسبوعية",
    excerpt_ar:
      "لوحة جديدة تلخص متوسط المضاعفات وأسرع القطاعات نمواً في السعودية.",
    content_ar:
      "أطلقنا لوحة مؤشرات السوق الأسبوعية لتلخيص حركة البيع والشراء على Shark Market. تعرض اللوحة متوسط مضاعفات الأرباح، حجم الصفقات الأكثر نشاطاً، وأبرز القطاعات طلباً خلال الأسبوع.\n\nيساعد هذا التحديث البائعين على تسعير أصولهم بشكل أدق، كما يمنح المشترين مرجعية واضحة قبل الدخول في المفاوضات. سنضيف قريباً مؤشرات فرعية حسب النوع مثل SaaS والمتاجر الإلكترونية والمحتوى.",
    tags: ["لوحة مؤشرات", "السعودية", "مضاعفات", "SaaS", "تحديثات"],
  },
  {
    title_ar: "تفعيل التحقق المالي الآلي للمشاريع المتوسطة",
    excerpt_ar:
      "خدمة تحقق أسرع للبيانات المالية مع تقارير جاهزة للمراجعة.",
    content_ar:
      "تم تفعيل مسار التحقق المالي الآلي للمشاريع التي تتراوح إيراداتها بين 50 و250 ألف ريال شهرياً. المنصة تجمع المستندات وتولد تقريراً مختصراً يساعد المشتري على اتخاذ قرار أسرع.\n\nالهدف هو تقليل وقت الفحص المبدئي وتحسين جودة القوائم المعروضة. يمكن للبائع متابعة حالة التحقق من خلال لوحة التحكم، مع إشعارات واضحة عند اكتمال المراجعة.",
    tags: ["تحقق مالي", "تقارير", "شركات متوسطة", "منصة"],
  },
  {
    title_ar: "ارتفاع الطلب على مشاريع المحتوى المتخصص في 2025",
    excerpt_ar:
      "سوق المحتوى العربي يشهد زيادة ملحوظة في صفقات الاستحواذ.",
    content_ar:
      "تشير بيانات المنصة إلى نمو واضح في الاهتمام بالمواقع المتخصصة ذات المحتوى العربي، خصوصاً في مجالات التعليم والمالية الشخصية. ارتفعت الاستفسارات بنسبة 28% مقارنة بالربع السابق.\n\nيعزو المشترون هذا الاهتمام إلى استقرار زيارات البحث العضوي وإمكانية إضافة منتجات رقمية ذات هامش ربح مرتفع. ننصح البائعين بتجهيز تقارير الأداء العضوي قبل إدراج المشروع.",
    tags: ["اتجاهات السوق", "محتوى", "بحث عضوي", "2025"],
  },
  {
    title_ar: "إضافة فلاتر الامتثال والملكية الفكرية للقوائم",
    excerpt_ar:
      "تسهيل التحقق من التراخيص والحقوق قبل الدخول في الصفقة.",
    content_ar:
      "أضفنا حقولاً جديدة ضمن صفحة الإدراج لعرض حالة التراخيص والملكية الفكرية. هذه الخطوة تعطي شفافية أكبر حول حقوق الأكواد، المحتوى، العلامة التجارية، واتفاقيات الموردين.\n\nكما أصبح بإمكان المشترين استخدام فلاتر متقدمة للبحث عن الأصول التي تحتوي على حقوق مضمونة أو عقود موثقة. هذه التحسينات تقلل المخاطر وتزيد سرعة إغلاق الصفقات.",
    tags: ["امتثال", "ملكية فكرية", "تحديثات المنتج"],
  },
  {
    title_ar: "شراكة مع مزودي الدفع المحليين لتحسين التحويلات",
    excerpt_ar:
      "خيارات دفع أسرع للمشترين داخل المملكة وخارجها.",
    content_ar:
      "وقعت Shark Market شراكات جديدة مع مزودي الدفع المحليين لدعم التحويلات الفورية والعملة المحلية. هذا التحديث يسهل إتمام الدفعات المسبقة ويقلل الوقت بين الاتفاق والتنفيذ.\n\nإضافة إلى ذلك، أتحنا للبائعين إمكانية تحديد طرق الاستلام المفضلة ودمجها مع إجراءات الضمان.",
    tags: ["مدفوعات", "SAR", "شراكات", "تحديثات"],
  },
  {
    title_ar: "توسيع برنامج التحقق للمشاريع SaaS",
    excerpt_ar:
      "التحقق الآن يشمل مؤشرات الاحتفاظ وملف الإيرادات المتكررة.",
    content_ar:
      "وسعنا برنامج التحقق للمشاريع SaaS ليشمل مؤشرات الاحتفاظ الشهري، معدل توسع الحسابات، ونسبة العملاء السنوية. هذه البيانات تعرض بشكل مبسط ضمن بطاقة المشروع.\n\nالهدف هو تمكين المشترين من تقييم جودة الإيراد المتكرر بسرعة، وإعطاء البائعين فرصة إبراز نقاط القوة الرئيسية.",
    tags: ["SaaS", "تحقق", "احتفاظ", "MRR"],
  },
  {
    title_ar: "تقرير ربع سنوي: مضاعفات الربح في السوق السعودي",
    excerpt_ar:
      "متوسط المضاعف ارتفع مع زيادة الطلب على المشاريع الموثقة.",
    content_ar:
      "أصدرنا تقرير الربع الأول الذي يوضح متوسط مضاعفات الربح حسب القطاع. لوحظ ارتفاع في مضاعفات المشاريع التي تمتلك مصادر دخل متكررة أو اشتراكات شهرية ثابتة.\n\nيساعد التقرير البائعين على مواءمة توقعاتهم السعرية، كما يمنح المشترين مقارنة مرجعية قبل التفاوض.",
    tags: ["تقرير", "مضاعفات", "السوق السعودي", "بيانات"],
  },
  {
    title_ar: "تحديث تجربة المشتري بتدقيق سريع للصفقات",
    excerpt_ar:
      "مسار جديد يختصر مرحلة المراجعة الأولية إلى 72 ساعة.",
    content_ar:
      "أطلقنا مساراً جديداً للمشترين الذين يحتاجون إلى تقييم مبدئي سريع قبل الدخول في مفاوضات متقدمة. يتم تحليل مؤشرات الأداء الأساسية خلال 72 ساعة مع ملخص نقاط القوة والمخاطر.\n\nهذا التحديث مناسب للمشترين الاستراتيجيين الذين يديرون عدة فرص في الوقت نفسه ويحتاجون إلى قرار سريع.",
    tags: ["تجربة المشتري", "تدقيق", "صفقات"],
  },
];

const STORIES_LIBRARY = [
  {
    title_ar: "قصة بيع متجر عناية بالبشرة في الرياض خلال 21 يوماً",
    excerpt_ar:
      "ترتيب البيانات المالية وتركيز التسويق على العملاء المتكررين سرّع الصفقة.",
    content_ar:
      "باع مالك متجر متخصص في منتجات العناية بالبشرة مشروعه خلال 21 يوماً بعد تنظيم بيانات المخزون وتوضيح تكلفة اكتساب العميل. أظهر الملف أن 62% من المبيعات تأتي من عملاء متكررين.\n\nجذب ذلك مشترياً يبحث عن مشروع قابل للتوسع، وتم الاتفاق على فترة انتقال تشغيل لمدة 45 يوماً لضمان استقرار الموردين.",
    tags: ["تجارة إلكترونية", "الرياض", "قصة بيع", "عملاء متكررون"],
  },
  {
    title_ar: "شراكة استراتيجية في منصة SaaS للفواتير",
    excerpt_ar:
      "مستثمر تشغيلي دخل كشريك بنسبة 30% لتوسيع السوق المحلي.",
    content_ar:
      "تلقى مؤسس منصة SaaS للفواتير عروضاً متعددة، لكنه اختار شريكاً تشغيلياً يمتلك خبرة في توزيع البرمجيات. الشراكة كانت بنسبة 30% مع التزام بتوسيع قنوات البيع خلال 6 أشهر.\n\nتم توثيق مؤشرات النمو المتوقعة وخطة التسويق قبل توقيع الاتفاق، مما سهّل عملية اتخاذ القرار.",
    tags: ["SaaS", "شراكة", "فواتير", "نمو"],
  },
  {
    title_ar: "استحواذ على مدونة تعليمية وتحويلها لاشتراكات",
    excerpt_ar:
      "المشتري ركّز على بناء مجتمع مدفوع وتحويل الزيارات إلى دخل متكرر.",
    content_ar:
      "تم الاستحواذ على مدونة تعليمية متخصصة في المهارات الرقمية مع متوسط 120 ألف زيارة شهرية. المشتري أطلق عضوية مدفوعة بمحتوى حصري ودروس قصيرة.\n\nبعد 3 أشهر، حققت العضوية 18% من إجمالي الدخل، مع توقعات نمو أعلى عند توسيع القنوات التسويقية.",
    tags: ["محتوى", "اشتراكات", "تعليم", "استحواذ"],
  },
  {
    title_ar: "شراء تطبيق لياقة باشتراكات شهرية",
    excerpt_ar:
      "تحسين تجربة الدفع وزيادة الاحتفاظ رفعا قيمة الصفقة.",
    content_ar:
      "اشترى فريق استثماري تطبيق لياقة يعتمد على الاشتراك الشهري. قبل الصفقة ركزوا على تحسين تجربة الدفع داخل التطبيق وتبسيط خطط الاشتراك.\n\nأظهرت البيانات أن معدل الاحتفاظ ارتفع 12% خلال شهرين، مما انعكس على قيمة المشروع وتم تثبيت سعر الشراء وفقاً للأداء المحقق.",
    tags: ["تطبيق", "اشتراكات", "احتفاظ", "لياقة"],
  },
  {
    title_ar: "خروج مؤسس من مشروع محتوى مالي",
    excerpt_ar:
      "صفقة منظمة مع انتقال إدارة المحتوى لفريق تحرير جديد.",
    content_ar:
      "قام مؤسس منصة محتوى مالي ببيع حصته بالكامل بعد تجهيز دليل إجراءات التحرير ومصفوفة مصادر الدخل. المشتري اعتمد على فريق تحرير مستقل لضمان الاستمرارية.\n\nساعدت وثائق التشغيل على تقليل فترة الانتقال إلى أقل من شهر، وتم الحفاظ على نفس معدل النمو العضوي.",
    tags: ["محتوى مالي", "خروج", "عمليات", "تحرير"],
  },
  {
    title_ar: "صفقة جزئية لبرمجية تحليلات المتاجر",
    excerpt_ar:
      "المشتري حصل على 40% مع التزام تقني لتطوير المنتج.",
    content_ar:
      "اتفق صاحب برمجية تحليلات متاجر على بيع 40% من الحصة لمستثمر تقني مقابل تطوير ميزات ذكاء أعمال جديدة. الصفقة تضمنت جدول تسليم مرحلي للمنتج.\n\nأُرفقت بالصفقة مؤشرات أداء واضحة، بما فيها معدل التحويل ومصدر العملاء الأساسي، مما طمأن الطرفين.",
    tags: ["تحليلات", "صفقة جزئية", "تطوير", "ذكاء أعمال"],
  },
  {
    title_ar: "تحويل نشرة بريدية إلى مشروع إعلاني مربح",
    excerpt_ar:
      "المشتري أعاد تسعير الرعايات وربطها بعروض SaaS.",
    content_ar:
      "استحوذ مستثمر فردي على نشرة بريدية متخصصة في ريادة الأعمال. بعد الاستحواذ أعاد تسعير الرعايات وربطها بعروض SaaS مخصصة للجمهور المستهدف.\n\nساهم ذلك في رفع الدخل الإعلاني بنسبة 35% خلال الربع الأول بعد الصفقة.",
    tags: ["نشرة بريدية", "إعلانات", "ريادة أعمال"],
  },
  {
    title_ar: "بيع أداة أتمتة للمطاعم في المنطقة الشرقية",
    excerpt_ar:
      "حزمة تدريب ودعم لمدة 60 يوماً ضمنت رضا المشتري.",
    content_ar:
      "باع فريق صغير أداة أتمتة للطلبات والمخزون إلى مشغل مطاعم يمتلك عدة فروع. الصفقة شملت تدريباً عملياً ودعماً فنياً لمدة 60 يوماً.\n\nهذه الإضافة رفعت ثقة المشتري وسهلت انتقال الملكية دون توقف الخدمة.",
    tags: ["أتمتة", "مطاعم", "خدمة ما بعد البيع"],
  },
];

const GUIDES_LIBRARY = [
  {
    title_ar: "قائمة تدقيق ما قبل عرض مشروعك للبيع",
    excerpt_ar:
      "خطوات سريعة لتجهيز البيانات المالية والتشغيلية قبل الإدراج.",
    content_ar:
      "ابدأ بتجميع تقارير الإيرادات والأرباح لآخر 12 شهراً، وتأكد من فصل المصروفات الشخصية عن مصروفات المشروع. جهّز أيضاً قائمة بالموردين والعقود النشطة.\n\nأضف ملخصاً لتدفقات الزيارات ومصادرها، وخطة واضحة لفترة الانتقال. هذه الخطوات تقلل الأسئلة المتكررة وتسرّع قرار المشتري.",
    tags: ["قائمة تدقيق", "بيع", "تحضير", "بيانات مالية"],
  },
  {
    title_ar: "كيف تحدد المضاعف العادل لمشروعك الرقمي",
    excerpt_ar:
      "المضاعف يعتمد على الاستقرار، النمو، وتنوع مصادر الدخل.",
    content_ar:
      "ابدأ بحساب متوسط الربح الشهري لآخر 12 شهراً، ثم قارن النتائج مع صفقات مشابهة في نفس القطاع. المشاريع ذات الإيراد المتكرر عادة تحصل على مضاعف أعلى.\n\nلا تنس تقييم المخاطر مثل الاعتماد على قناة تسويق واحدة أو عميل كبير. كلما زادت الاستدامة والتنوع ارتفع المضاعف العادل.",
    tags: ["تقييم", "مضاعفات", "تسعير", "MRR"],
  },
  {
    title_ar: "سبع خطوات لمراجعة مصادر الزيارات قبل الشراء",
    excerpt_ar:
      "تحقق من جودة الزيارات واستقرارها لتجنب المفاجآت بعد الاستحواذ.",
    content_ar:
      "راجع توزيع الزيارات بين البحث العضوي، الإعلانات المدفوعة، والإحالات. قارن الأداء خلال 6 أشهر على الأقل للتأكد من الاستقرار.\n\nركز على الكلمات المفتاحية الأساسية، واختبر أي تحديثات محركات بحث قد تؤثر على الأداء. هذا يساعد على تقدير المخاطر الفعلية للمشروع.",
    tags: ["زيارات", "SEO", "تحقق", "تحليل"],
  },
  {
    title_ar: "إعداد غرفة بيانات منظمة للمشترين",
    excerpt_ar:
      "تنظيم الملفات يرفع ثقة المشتري ويقلل زمن الفحص.",
    content_ar:
      "أنشئ مجلدات منفصلة للتقارير المالية، العقود، والتحليلات التسويقية. استخدم أسماء واضحة للملفات وحدد نطاقات زمنية ثابتة.\n\nأرفق ملخصاً تنفيذياً في صفحة واحدة يوضح أهم الأرقام والمخاطر. هذه الخطوة تجعل التجربة أكثر احترافية وتزيد احتمال إتمام الصفقة.",
    tags: ["غرفة بيانات", "فحص", "احترافية"],
  },
  {
    title_ar: "التفاوض على بنود الصفقة دون خسارة القيمة",
    excerpt_ar:
      "رتب أولوياتك بين السعر، الجدول الزمني، وفترة الانتقال.",
    content_ar:
      "حدد البنود غير القابلة للتنازل مثل الحد الأدنى للسعر أو مدة الانتقال. اترك مساحة مرنة لبنود أقل تأثيراً مثل طريقة الدفع أو خطة التسليم.\n\nاستخدم بيانات الأداء لإثبات القيمة، واطلب إطاراً زمنياً واضحاً لتفادي إطالة المفاوضات.",
    tags: ["تفاوض", "صفقات", "استراتيجية"],
  },
  {
    title_ar: "كيف تجهز انتقال التشغيل بسلاسة",
    excerpt_ar:
      "خطة انتقال قصيرة مع مهام أسبوعية تقلل المخاطر.",
    content_ar:
      "ابدأ بتوثيق العمليات اليومية وأسماء الأدوات الأساسية. حدد نقاط الاتصال مع الموردين، وخطط لتسليم كلمات المرور بشكل آمن.\n\nقسّم الانتقال إلى أسابيع تشمل التدريب، التسليم، ثم فترة دعم بعد البيع. هذا يطمئن المشتري ويحافظ على استقرار الإيرادات.",
    tags: ["انتقال", "تشغيل", "خطة"],
  },
  {
    title_ar: "قياس جودة الإيراد المتكرر للمشاريع SaaS",
    excerpt_ar:
      "تحليل churn وCAC يساعدك على تقدير القيمة الحقيقية.",
    content_ar:
      "لا يكفي معرفة قيمة الإيراد المتكرر الشهري، يجب فحص معدل الإلغاء الشهري ومعدل توسع الحسابات. المشاريع التي تتوسع مع العملاء الحاليين تحصل على تقييم أفضل.\n\nاحسب أيضاً تكلفة اكتساب العميل مقابل قيمة عمر العميل، وقدم هذه الأرقام بشكل واضح للمشتري.",
    tags: ["SaaS", "MRR", "Churn", "CAC"],
  },
  {
    title_ar: "اختيار شريك تشغيلي مناسب للمشروع",
    excerpt_ar:
      "ضع معايير واضحة للدور المطلوب قبل البحث عن الشريك.",
    content_ar:
      "حدد ما إذا كنت تحتاج شريكاً تقنياً أو شريكاً تجارياً، ثم اربط ذلك بأهداف النمو خلال 12 شهراً. وجود وصف واضح للدور يختصر وقت البحث.\n\nاطلب أمثلة على مشاريع سابقة ونتائج قابلة للقياس قبل الاتفاق النهائي.",
    tags: ["شراكة", "تشغيل", "نمو"],
  },
];

const pickFrom = (list, index) => list[index % list.length];

const computeReadingTime = (content) => {
  const words = content.replace(/\s+/g, " ").trim().split(" ").length;
  const minutes = Math.max(3, Math.round(words / 180));
  return minutes;
};

const makeCoverImage = (label, colors) => {
  const [start, end] = colors;
  const svg = `\n    <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="800">\n      <defs>\n        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">\n          <stop offset="0%" stop-color="${start}" />\n          <stop offset="100%" stop-color="${end}" />\n        </linearGradient>\n      </defs>\n      <rect width="1200" height="800" fill="url(#g)" />\n      <rect x="70" y="520" width="1060" height="210" rx="24" fill="#ffffff" opacity="0.9" />\n      <text x="110" y="600" font-family="Plus Jakarta Sans, Arial" font-size="42" font-weight="700" fill="#0f172a">\n        ${label}\n      </text>\n      <text x="110" y="660" font-family="Plus Jakarta Sans, Arial" font-size="24" fill="#475569">\n        Shark Market Blog\n      </text>\n    </svg>\n  `;
  return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
};

export const generatePost = ({ type, sequence = 1, createdAt }) => {
  const normalizedType = type || TYPE_ORDER[sequence % TYPE_ORDER.length];
  const library =
    normalizedType === "news"
      ? NEWS_LIBRARY
      : normalizedType === "stories"
        ? STORIES_LIBRARY
        : GUIDES_LIBRARY;
  const topic = pickFrom(library, sequence);
  const coverColors = COVER_GRADIENTS[sequence % COVER_GRADIENTS.length];
  const timestamp = createdAt || Date.now();

  return {
    id: `post-${sequence}`,
    slug: `${normalizedType}-${sequence}`,
    type: normalizedType,
    title_ar: topic.title_ar,
    excerpt_ar: topic.excerpt_ar,
    content_ar: topic.content_ar,
    createdAt: new Date(timestamp).toISOString(),
    tags: topic.tags,
    coverImage: makeCoverImage(topic.title_ar, coverColors),
    readingTime: computeReadingTime(topic.content_ar),
  };
};

export const pickTypeByIndex = (index) => TYPE_ORDER[index % TYPE_ORDER.length];
